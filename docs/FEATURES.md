# 機能ガイド

Beer Bankbook アプリケーションの機能説明と使用方法について説明します。

## 概要

Beer Bankbookは、ビールの飲酒記録を管理し、支出を追跡できるWebアプリケーションです。
この度、データベース連携機能、ビール追加機能、検索機能の強化を実装しました。

## 新機能

### 🔄 データベース連携機能

**実装前**: 模擬データ（ハードコーディング）を使用
**実装後**: PostgreSQLデータベースからリアルタイムでデータを取得

#### 特徴
- リアルタイムデータ取得
- データの永続化
- 複数ユーザーでのデータ共有
- データの整合性保証

#### 利用可能なデータ
- **ビール**: 10種類（アサヒスーパードライ、キリン一番搾り等）
- **レストラン**: 8店舗（鳥貴族、キリンシティ等）
- **カテゴリ**: 6種類（ラガー、エール、IPA、スタウト、ヴァイツェン、ピルスナー）

### 🍺 ビール追加機能

新しいビールをデータベースに追加できる機能を実装しました。

#### アクセス方法
1. 飲酒記録作成画面（`/drinking/new`）を開く
2. ビール選択モーダルで「新しいビールを追加」ボタンをクリック
3. ビール追加画面（`/beers/new`）に移動

#### 入力項目
| 項目 | 必須 | 説明 | 例 |
|------|------|------|---|
| ビール名 | ✅ | ビールの商品名 | `クラフトIPA` |
| 醸造所 | - | 製造会社名 | `地ビール工房` |
| カテゴリ | - | ビールの種類 | `IPA` |
| アルコール度数 | - | %単位 | `6.5` |
| 原産国 | - | 製造国 | `日本` |
| 説明 | - | ビールの特徴 | `ホップの香りが強い` |
| 画像URL | - | ビールの画像 | `https://...` |
| Untappd ID | - | 外部連携ID | `beer_id` |

#### 機能
- **リアルタイムプレビュー**: 入力内容が即座にプレビューに反映
- **画像プレビュー**: 画像URLを入力すると画像が表示
- **カテゴリ選択**: データベースから取得したカテゴリから選択
- **バリデーション**: ビール名の必須チェック
- **エラーハンドリング**: 適切なエラーメッセージ表示

### 🔍 検索機能の強化

ビール選択時の検索機能を大幅に強化しました。

#### 基本検索
- **対象**: ビール名、醸造所名、説明文
- **方式**: 部分一致検索（大文字小文字区別なし）
- **例**: `アサヒ` → アサヒスーパードライがヒット

#### 詳細フィルター
詳細フィルターボタンをクリックすることで、以下の条件で絞り込み可能：

##### 1. カテゴリフィルター
- **利用可能カテゴリ**: ラガー、エール、IPA、スタウト、ヴァイツェン、ピルスナー
- **表示**: アイコン付きのセレクトボックス
- **例**: `🍺 ラガー` を選択

##### 2. アルコール度数フィルター
- **最小アルコール度数**: 下限値を指定
- **最大アルコール度数**: 上限値を指定
- **例**: 4.0% ～ 6.0% の範囲で絞り込み

##### 3. 醸造所フィルター
- **対象**: 醸造所名
- **方式**: 部分一致検索
- **例**: `アサヒ` → アサヒビール製のビールのみ表示

#### 検索結果の表示
- **ビール名**: 太字で表示
- **副情報**: 醸造所名 • カテゴリ
- **アルコール度数**: xx%で表示
- **説明**: 設定されている場合のみ表示

#### 検索のリセット
- **フィルタークリアボタン**: すべての検索条件をリセット
- **モーダル閉じる**: 検索条件をリセットしてモーダルを閉じる

## 既存機能

### 🍺 飲酒記録作成

新しい飲酒記録を作成する機能です。

#### アクセス方法
- メインページから「🍺 お酒を追加」ボタンをクリック
- URL: `http://localhost:3000/drinking/new`

#### 入力項目
1. **ビール選択** ⭐必須
   - 検索・フィルター機能で選択
   - 新しいビールの追加も可能

2. **容量と価格**
   - 容量（ml）: 330ml, 350ml, 500ml のクイック選択可能
   - 価格（円）: 300円, 500円, 800円 のクイック選択可能

3. **日時** ⭐必須
   - 現在時刻がデフォルト設定
   - 過去・未来の日時も選択可能

4. **場所**（オプション）
   - レストラン・居酒屋等の選択
   - 検索機能で絞り込み可能

5. **評価**
   - 1～5点の星評価
   - デフォルト: 5点

6. **コメント**（オプション）
   - 自由入力のテキストエリア
   - 飲酒の感想等を記録

7. **SNSシェア**
   - ON/OFFの切り替え
   - 将来的にSNS連携予定

### 📊 データベース管理

pgAdminを使用してデータベースを管理できます。

#### アクセス方法
- URL: `http://localhost:8080`
- ログイン情報:
  - **メールアドレス**: `admin@beerbankbook.com`
  - **パスワード**: `admin123`

#### データベース接続設定
- **ホスト名**: `postgres`
- **ポート**: `5432`
- **データベース名**: `beer_bankbook`
- **ユーザー名**: `beer_user`
- **パスワード**: `secure_password`

#### 利用可能な操作
- テーブル内容の確認
- データの追加・編集・削除
- SQLクエリの実行
- データのエクスポート・インポート
- パフォーマンス分析

## 画面フロー

### 1. 飲酒記録作成フロー

```
メインページ
    ↓
[🍺 お酒を追加] クリック
    ↓
飲酒記録作成画面 (/drinking/new)
    ↓
[ビールを選択] クリック
    ↓
ビール検索モーダル
    ├─ 検索・フィルターでビール選択
    ├─ [新しいビールを追加] クリック
    │       ↓
    │   ビール追加画面 (/beers/new)
    │       ↓
    │   [ビールを追加] クリック
    │       ↓
    │   飲酒記録作成画面に戻る
    └─ ビール選択
    ↓
容量・価格・日時・場所・評価・コメント入力
    ↓
[🍺 記録を保存] クリック
    ↓
保存完了（メインページに戻る予定）
```

### 2. ビール追加フロー

```
飲酒記録作成画面
    ↓
ビール検索モーダル
    ↓
[新しいビールを追加] クリック
    ↓
ビール追加画面 (/beers/new)
    ↓
基本情報入力（ビール名、醸造所、カテゴリ等）
    ↓
詳細情報入力（説明、画像URL、Untappd ID）
    ↓
プレビュー確認
    ↓
[🍺 ビールを追加] クリック
    ↓
追加完了
    ↓
[キャンセル] で飲酒記録作成画面に戻る
```

## トラブルシューティング

### データが表示されない場合

1. **データベース接続確認**
   ```bash
   docker-compose ps
   ```
   PostgreSQLコンテナが起動していることを確認

2. **Prismaクライアント生成**
   ```bash
   cd frontend
   npx prisma generate
   ```

3. **データベース初期化**
   ```bash
   docker-compose exec postgres psql -U beer_user -d beer_bankbook -f /docker-entrypoint-initdb.d/01-init-schema.sql
   docker-compose exec postgres psql -U beer_user -d beer_bankbook -f /docker-entrypoint-initdb.d/02-sample-data.sql
   ```

### API エラーが発生する場合

1. **サーバー再起動**
   ```bash
   cd frontend
   npm run dev
   ```

2. **ブラウザキャッシュクリア**
   - ハードリロード（Ctrl+Shift+R / Cmd+Shift+R）
   - 開発者ツールでキャッシュ無効化

3. **ネットワークタブ確認**
   - 開発者ツールのNetworkタブでAPIレスポンスを確認
   - エラーメッセージの詳細確認

### ビール追加でエラーが発生する場合

1. **必須フィールド確認**
   - ビール名が入力されているか確認

2. **画像URL確認**
   - 有効なURLが入力されているか確認
   - HTTPS URLを推奨

3. **アルコール度数確認**
   - 数値のみ入力（0-20の範囲）

## 今後の機能拡張予定

### 認証機能
- ユーザー登録・ログイン
- OAuth連携（Google, Twitter等）
- ユーザー固有のデータ管理

### SNS連携
- Instagram, Twitter投稿機能
- Untappd連携
- 友人との記録共有

### 統計・分析機能
- 月別・年別飲酒量統計
- カテゴリ別分析
- 支出分析・家計簿機能

### レコメンデーション機能
- 過去の記録に基づくビール推薦
- 似た嗜好のユーザーとの比較
- 季節・天気に基づく推薦

### モバイル対応
- PWA（Progressive Web App）化
- プッシュ通知
- オフライン機能

## 技術仕様

### フロントエンド
- **Framework**: Next.js 15.3.5 (App Router)
- **UI Library**: React 19 + TypeScript
- **Styling**: Tailwind CSS 4
- **State Management**: React Hooks

### バックエンド
- **API**: Next.js API Routes
- **Database**: PostgreSQL 16
- **ORM**: Prisma
- **Validation**: TypeScript + Runtime validation

### インフラ
- **Development**: Docker + Docker Compose
- **Database Admin**: pgAdmin 4
- **Build Tool**: Turbopack（開発時） 